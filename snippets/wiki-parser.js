var f=null,W="https://cdn.workers.do/wtf-data.json",F=["category","categoria","categor\xEDa","cat\xE9gorie","kategorie","kategori","\u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F","\u062A\u0635\u0646\u064A\u0641","\u5206\u7C7B"],G=["infobox","ficha","info","\u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0430","bilgi kutusu","kotak info","\u05EA\u05D1\u05E0\u05D9\u05EA","\u0628\u0637\u0627\u0642\u0629","\uC815\uBCF4\uC0C1\uC790"],J=["redirect","weiterleitung","redirection","redirecci\xF3n","\u043F\u0435\u0440\u0435\u043D\u0430\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435","\u062A\u062D\u0648\u064A\u0644","\u91CD\u5B9A\u5411"],g=["January","February","March","April","May","June","July","August","September","October","November","December"],z=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],T={"\xA3":"GB\xA3","\xA5":"\xA5","\u20AC":"\u20AC","\u20B9":"\u20B9","\u20BD":"\u20BD","\u20A9":"\u20A9","\u20B1":"\u20B1",usd:"US$",us$:"US$",gbp:"GB\xA3",eur:"\u20AC",jpy:"\xA5",cny:"CN\xA5",inr:"\u20B9",rub:"\u20BD",aud:"A$",cad:"CA$",chf:"CHF",hkd:"HK$",sgd:"SGD",nzd:"NZ$",krw:"\u20A9",mxn:"MX$",brl:"R$",zar:"R"},B=[["\u{1F1FA}\u{1F1F8}","usa","united states"],["\u{1F1EC}\u{1F1E7}","gbr","united kingdom"],["\u{1F1E9}\u{1F1EA}","ger","germany"],["\u{1F1EB}\u{1F1F7}","fra","france"],["\u{1F1EE}\u{1F1F9}","ita","italy"],["\u{1F1EA}\u{1F1F8}","esp","spain"],["\u{1F1E7}\u{1F1F7}","bra","brazil"],["\u{1F1E6}\u{1F1F7}","arg","argentina"],["\u{1F1EF}\u{1F1F5}","jpn","japan"],["\u{1F1E8}\u{1F1F3}","chn","china"],["\u{1F1F0}\u{1F1F7}","kor","south korea"],["\u{1F1E6}\u{1F1FA}","aus","australia"],["\u{1F1E8}\u{1F1E6}","can","canada"],["\u{1F1F3}\u{1F1F1}","ned","netherlands"],["\u{1F1E7}\u{1F1EA}","bel","belgium"],["\u{1F1F5}\u{1F1F9}","por","portugal"],["\u{1F1F7}\u{1F1FA}","rus","russia"],["\u{1F1F5}\u{1F1F1}","pol","poland"],["\u{1F1F2}\u{1F1FD}","mex","mexico"],["\u{1F1EE}\u{1F1F3}","ind","india"]];async function D(r){try{let t=await fetch(r||W);t.ok&&(f=await t.json())}catch(t){console.debug("[wtf-lite] CDN data load failed, using inline defaults:",t instanceof Error?t.message:t)}}var A=r=>(r||"").replace(/^\s+|\s+$/g,"").replace(/ {2,}/g," "),y=class{data;constructor(t={}){this.data={type:"internal",...t}}text(t){return t!==void 0&&(this.data.text=t),(this.data.text||this.data.page||"").replace(/'{2,}/g,"")}page(t){return t!==void 0&&(this.data.page=t),this.data.page}type(){return this.data.type||"internal"}anchor(){return this.data.anchor||""}raw(){return this.data.raw||""}json(){return{text:this.text(),type:this.type(),page:this.page(),anchor:this.anchor()||void 0}}},_=class{data;constructor(t={}){this.data=t}links(){return this.data.links||[]}text(t){return t!==void 0&&(this.data.text=t),this.data.text||""}bold(){return this.data.fmt?.bold?.[0]}json(){return{text:this.text(),links:this.links().map(t=>t.json())}}},$=class{_data;constructor(t){this._data=t}lines(){return this._data}links(){return this._data.flatMap(t=>t.links())}text(){return this._data.map(t=>" * "+t.text()).join(`
`)}},j=class{_type;data;constructor(t){this._type=t.type,this.data=t.data||{}}type(){return this._type}links(){return Object.values(this.data).flatMap(t=>t?.links?.()||[])}get(t){let e=(t||"").toLowerCase().replace(/[-_]/g," ").trim();for(let[s,n]of Object.entries(this.data))if(s.toLowerCase().replace(/[-_]/g," ").trim()===e)return n;return new _}keyValue(){let t={};for(let[e,s]of Object.entries(this.data))s&&(t[e]=s.text());return t}json(){return{type:this._type,data:this.keyValue()}}},R=class{_sentences;_lists;constructor(t){this._sentences=t.sentences,this._lists=t.lists}sentences(){return this._sentences}lists(){return this._lists}links(){return this._sentences.flatMap(t=>t.links())}text(){let t=this._sentences.map(e=>e.text()).join(" ");return this._lists.forEach(e=>t+=`
`+e.text()),t}},S=class{_title;_depth;_wiki;_paragraphs=[];_infoboxes=[];_templates=[];_coordinates=[];constructor(t,e){this._title=t.title||"",this._depth=t.depth,this._wiki=t.wiki||"",this.parseTemplates(e),this._wiki=this._wiki.replace(/<ref[^>]*>(?:[^<]|<(?!\/ref>))*<\/ref>/gi," ").replace(/<ref[^>]*\/>/gi," "),this.parseParagraphs()}title(){return this._title}depth(){return this._depth}paragraphs(){return this._paragraphs}infoboxes(){return this._infoboxes}templates(){return this._templates}coordinates(){return this._coordinates}sentences(){return this._paragraphs.flatMap(t=>t.sentences())}links(){return[...this._infoboxes.flatMap(t=>t.links()),...this.sentences().flatMap(t=>t.links()),...this.lists().flatMap(t=>t.links())]}lists(){return this._paragraphs.flatMap(t=>t.lists())}text(){return this._paragraphs.map(t=>t.text()).join(`

`)}parseTemplates(t){let e=O(this._wiki),s=f?.infoboxes||G,n=new RegExp("^(subst.)?("+s.join("|")+")(?=:| |\\n|$)","i");for(let i of e){let o=i.name.toLowerCase();if(n.test(o)||/^infobox /i.test(o)||/ infobox$/i.test(o)){let a=p(i.body,"raw"),u=a.template||"",h=u.match(n);h?.[0]&&(u=u.replace(h[0],"").trim()),delete a.template,delete a.list,this._infoboxes.push(new j({type:u,data:a})),this._wiki=this._wiki.replace(i.body,"");continue}if(o==="coord"||o.startsWith("coor")){let a=M(i.body);a.lat&&a.lon&&(this._coordinates.push({lat:a.lat,lon:a.lon}),this._templates.push(a),(a.display||"inline").includes("inline")?this._wiki=this._wiki.replace(i.body,`${a.lat}\xB0${a.latDir}, ${a.lon}\xB0${a.lonDir}`):this._wiki=this._wiki.replace(i.body,""));continue}if(o==="birth date and age"||o==="bda"||o==="birth date"){let a=et(i.body,this._templates);this._wiki=this._wiki.replace(i.body,a);continue}if(o==="death date and age"||o==="death date"){let a=nt(i.body,this._templates);this._wiki=this._wiki.replace(i.body,a);continue}if(o==="start date"||o==="end date"||o==="start"||o==="end"){let a=it(i.body,this._templates);this._wiki=this._wiki.replace(i.body,a);continue}if(o==="currentday"||o==="localday"){this._wiki=this._wiki.replace(i.body,String(new Date().getDate()));continue}if(o==="currentmonth"||o==="currentmonthname"||o==="localmonth"){this._wiki=this._wiki.replace(i.body,g[new Date().getMonth()]);continue}if(o==="currentyear"||o==="localyear"){this._wiki=this._wiki.replace(i.body,String(new Date().getFullYear()));continue}if(o==="currentdayname"||o==="localdayname"){this._wiki=this._wiki.replace(i.body,z[new Date().getDay()]);continue}if(o==="as of"){let a=st(i.body);this._wiki=this._wiki.replace(i.body,a);continue}if(T[o]||o==="currency"){let a=ot(i.body);this._wiki=this._wiki.replace(i.body,a);continue}if(o==="goal"){let a=at(i.body,this._templates);this._wiki=this._wiki.replace(i.body,a);continue}if(o==="player"){let a=ct(i.body,this._templates);this._wiki=this._wiki.replace(i.body,a);continue}if(o==="sports table"){lt(i.body,this._templates),this._wiki=this._wiki.replace(i.body,"");continue}if(o==="4teambracket"||o.includes("teambracket")){pt(i.body,this._templates),this._wiki=this._wiki.replace(i.body,"");continue}if(o==="convert"||o==="cvt"){let a=ut(i.body);this._wiki=this._wiki.replace(i.body,a);continue}if(o==="fraction"||o==="frac"){let a=ht(i.body);this._wiki=this._wiki.replace(i.body,a);continue}if(o==="val"){let a=gt(i.body);this._wiki=this._wiki.replace(i.body,a);continue}if(o==="sortname"){let a=ft(i.body);this._wiki=this._wiki.replace(i.body,a);continue}if(o==="hlist"||o==="plainlist"||o==="flatlist"){let a=dt(i.body);this._wiki=this._wiki.replace(i.body,a);continue}if(o==="ubl"||o==="ubil"||o==="unbulleted list"){let a=mt(i.body);this._wiki=this._wiki.replace(i.body,a);continue}if(o==="bulleted list"){let a=bt(i.body);this._wiki=this._wiki.replace(i.body,a);continue}if(o==="url"){let a=P(i.body);this._wiki=this._wiki.replace(i.body,a);continue}if(o==="nihongo"||o==="nihongo2"||o==="nihongo3"||o==="nihongo-s"||o==="nihongo foot"){let a=I(i.body);this._wiki=this._wiki.replace(i.body,a);continue}let c=f?.hardcoded||{};if(c[o]){this._wiki=this._wiki.replace(i.body,c[o]);continue}if((f?.pronouns||["they","them","their","theirs","themself"]).includes(o)){this._wiki=this._wiki.replace(i.body,o);continue}this._wiki=this._wiki.replace(i.body,"")}}parseParagraphs(){let t=this._wiki.split(/\r?\n\r?\n/).filter(e=>e?.trim());this._paragraphs=t.map(e=>{let s={wiki:e,lists:[],sentences:[]};return yt(s),s.sentences=Q(s.wiki).map(d),s.sentences[0]?.text()?.startsWith(":")&&(s.sentences=s.sentences.slice(1)),new R(s)})}},N=class{_wiki;_title;_categories=[];_sections=[];_type="page";_redirectTo=null;constructor(t,e={}){this._wiki=t||"",this._title=e.title||null;let s=f?.redirects||J,n=new RegExp("^\\s*#("+s.join("|")+")\\s*(\\[\\[[^\\]]{2,180}?\\]\\])","i");if(n.test(this._wiki)){this._type="redirect";let i=this._wiki.match(n);if(i?.[2]){let o=E(i[2]);this._redirectTo=o[0]||null}this.parseCategories();return}this._wiki=H(this._wiki),this.parseCategories(),this._sections=wt(this)}parseCategories(){let t=f?.categories||F,e=new RegExp("\\[\\[("+t.join("|")+"):([^\\]]{2,178}?)\\]\\](\\w{0,10})","gi"),s=new RegExp("^\\[\\[:?("+t.join("|")+"):","gi"),n=this._wiki.match(e)||[];for(let i of n)i=i.replace(s,"").replace(/\|?[ *]?\]\]$/,"").replace(/\|.*/,""),i&&!i.match(/[[\]]/)&&this._categories.push(i.trim());this._wiki=this._wiki.replace(e,"")}title(t){return t!==void 0?(this._title=t,t):this._title||this.sentences()[0]?.bold()||null}isRedirect(){return this._type==="redirect"}redirectTo(){return this._redirectTo}categories(t){return typeof t=="number"?[this._categories[t]]:this._categories}sections(t){return typeof t=="string"?this._sections.filter(e=>e.title().toLowerCase()===t.toLowerCase().trim()):typeof t=="number"?[this._sections[t]]:this._sections}paragraphs(){return this._sections.flatMap(t=>t.paragraphs())}sentences(){return this._sections.flatMap(t=>t.sentences())}links(){return this._sections.flatMap(t=>t.links())}infoboxes(){return this._sections.flatMap(t=>t.infoboxes()).sort((t,e)=>Object.keys(e.data).length-Object.keys(t.data).length)}coordinates(){return this._sections.flatMap(t=>t.coordinates())}templates(){return this._sections.flatMap(t=>t.templates())}text(){return this.isRedirect()?"":this._sections.map(t=>t.text()).join(`

`)}json(){return{title:this.title(),categories:this.categories(),coordinates:this.coordinates(),sections:this._sections.map(t=>({title:t.title(),depth:t.depth(),paragraphs:t.paragraphs().map(e=>({sentences:e.sentences().map(s=>s.json())})),infoboxes:t.infoboxes().map(e=>e.json())}))}}};function H(r){r=r.replace(/<!--(?:[^-]|-(?!->)){0,3000}-->/g,""),r=r.replace(/__(NOTOC|NOEDITSECTION|FORCETOC|TOC)__/gi,""),r=r.replace(/~{2,3}/g,"").replace(/\r/g,"").replace(/\u3002/g,". ").replace(/----/g,""),r=r.replace(/&nbsp;/g," ").replace(/&ndash;/g,"-").replace(/&mdash;/g,"-"),r=r.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'");let t=["file","image","fichier","archivo","datei","bestand","bild","plik","\u0444\u0430\u0439\u043B","\u30D5\u30A1\u30A4\u30EB","\u6587\u4EF6","\u6A94\u6848","\u05EA\u05DE\u05D5\u05E0\u05D4","\u0645\u0644\u0641","\u062A\u0635\u0648\u06CC\u0631"],e=new RegExp(`\\[\\[(${t.join("|")}):`,"gi"),s;for(;(s=e.exec(r))!==null;){let i=s.index,o=0,c=i;for(let l=i;l<r.length-1;l++)if(r[l]==="["&&r[l+1]==="[")o++,l++;else if(r[l]==="]"&&r[l+1]==="]"&&(o--,l++,o===0)){c=l+1;break}c>i&&(r=r.slice(0,i)+r.slice(c),e.lastIndex=i)}let n=["table","code","score","data","categorytree","charinsert","hiero","imagemap","inputbox","references","source","syntaxhighlight","timeline","maplink"];return r=r.replace(new RegExp(`< ?(${n.join("|")}) ?[^>]{0,200}>(?:[^<]|<(?!\\s?/\\s?(${n.join("|")})\\s?>))+< ?/ ?(${n.join("|")}) ?>`,"gi")," "),r=r.replace(/ ?< ?(span|div|table|data) [a-zA-Z0-9=%.\-#:;'" ]{2,100}\/? ?> ?/g," "),r=r.replace(/<i>([^<]*(?:<(?!\/i>)[^<]*)*)<\/i>/g,"''$1''").replace(/<b>([^<]*(?:<(?!\/b>)[^<]*)*)<\/b>/g,"'''$1'''"),r=r.replace(/ ?<[ /]?(p|sub|sup|span|nowiki|div|table|br|tr|td|th|pre|hr|u)[ /]?> ?/g," "),r=r.replace(/ ?< ?br ?\/> ?/g,`
`).replace(/\([,;: ]+\)/g,""),r.trim()}var V=/^(category|catégorie|kategorie|categoría|categoria|categorie|image|file|fichier|datei|media):/i,q=/\[(https?|news|ftp|mailto|gopher|irc)(:\/\/[^\]| ]{4,1500})([| ][^\]]{0,500})?\]/g,Y=/\[\[([^\]]{0,1600}?)\]\]([a-z]+)?/gi;function E(r){let t=[];return r.replace(q,(e,s,n,i)=>(t.push(new y({type:"external",site:s+n,text:(i||"").trim(),raw:e})),i||"")),r.replace(Y,(e,s,n)=>{let i=null,o=s;if(s.match(/\|/)&&(o=s.replace(/([^|]{2,1000})\|[^|]{0,2000}/,"$1"),i=s.replace(/[^|]{2,1000}?\|/,"")),o.match(V))return s;let c={page:o,raw:e};return c.page=c.page.replace(/#(.*)/,(l,a)=>(c.anchor=a,"")),i!==null&&i!==c.page&&(c.text=i),n&&(c.text=c.text||c.page,c.text+=n.trim()),t.push(new y(c)),s}),t}function Z(r){r.links=E(r.text),r.links.forEach(n=>{n.raw()&&(r.text=r.text.replace(n.raw(),n.text()||n.page()||""))});let t=["file","image","fichier","archivo","datei","bestand","bild","plik","\u0444\u0430\u0439\u043B","\u30D5\u30A1\u30A4\u30EB","\u6587\u4EF6","\u6A94\u6848","\u05EA\u05DE\u05D5\u05E0\u05D4","\u0645\u0644\u0641","\u062A\u0635\u0648\u06CC\u0631"],e=new RegExp(`\\[\\[(${t.join("|")}):`,"gi"),s;for(;(s=e.exec(r.text))!==null;){let n=s.index,i=0,o=n;for(let c=n;c<r.text.length-1;c++)if(r.text[c]==="["&&r.text[c+1]==="[")i++,c++;else if(r.text[c]==="]"&&r.text[c+1]==="]"&&(i--,c++,i===0)){o=c+1;break}o>n&&(r.text=r.text.slice(0,n)+r.text.slice(o),e.lastIndex=n)}}var X=["mr","mrs","ms","dr","prof","sr","jr","vs","etc","esp","eg","ie","inc","ltd","co","corp","st","mt","ft","gen","gov","jan","feb","mar","apr","jun","jul","aug","sep","oct","nov","dec","no","vol","pp","ca"],K=new RegExp("(^| |')("+X.join("|")+")[.!?] ?$","i");function Q(r){if(!r?.trim())return[];let t=r.split(/(\n+)/).filter(n=>n.match(/\S/));t=t.flatMap(n=>n.split(/(\S[^\n.!?]*[.!?]"?)(?=\s|$)/g));let e=[];for(let n=0;n<t.length;n++){let i=t[n];if(!i||!i.match(/\S/)){e[e.length-1]&&(e[e.length-1]+=i);continue}e.push(i)}let s=[];for(let n=0;n<e.length;n++)e[n+1]&&(K.test(e[n])||/[ .'][A-Z].? *$/i.test(e[n])||/\.{3,} +$/.test(e[n]))?e[n+1]=e[n]+(!/^\s/.test(e[n+1])&&!/\s$/.test(e[n])?" ":"")+e[n+1]:e[n]?.length>0&&(s.push(e[n]),e[n]="");return s.length===0?[r]:s}function d(r){let t={text:r};Z(t),t.text=A(t.text||"").replace(/\([,;: ]*\)/g,"").replace(/ +\.$/,".");let e=[],s=[];return t.text=t.text.replace(/'''''([^']{0,2500}|'(?!')){0,2500}'''''/g,(n,i)=>(e.push(i),s.push(i),i)),t.text=t.text.replace(/'''([^']{0,2500}|'(?!')|''(?!')){0,2500}'''/g,(n,i)=>(e.push(i),i)),t.text=t.text.replace(/''([^']{0,2500}|'(?!')){0,2500}''/g,(n,i)=>(s.push(i),i)),(e.length||s.length)&&(t.fmt={bold:e.length?e:void 0,italic:s.length?s:void 0}),new _(t)}function O(r){let t=[],e=0,s=[];for(let n=r.indexOf("{");n!==-1&&n<r.length;e>0?n++:n=r.indexOf("{",n+1)){let i=r[n];if(i==="{"&&e++,e>0){if(i==="}"&&(e--,e===0)){s.push(i);let o=s.join("");s=[],/\{\{/.test(o)&&/\}\}/.test(o)&&t.push(o);continue}if(e===1&&i!=="{"&&i!=="}"){e=0,s=[];continue}s.push(i)}}return t.map(n=>({body:n,name:tt(n)}))}function tt(r){let t=null;return/^\{\{[^\n]+\|/.test(r)?t=(r.match(/^\{\{(.+?)\|/)||[])[1]:r.indexOf(`
`)!==-1?t=(r.match(/^\{\{(.+)\n/)||[])[1]:t=(r.match(/^\{\{(.+?)\}\}$/)||[])[1],t?t.replace(/:.*/,"").trim().toLowerCase().replace(/_/g," "):""}function p(r,t){r=r.replace(/^\{\{/,"").replace(/\}\}$/,"");let e=r.split(/\n?\|/);e.forEach((i,o)=>{i!==null&&(/\[\[[^\]]+$/.test(i)||/\{\{[^}]+$/.test(i)||i.split("{{").length!==i.split("}}").length||i.split("[[").length!==i.split("]]").length)&&(e[o+1]=e[o]+"|"+e[o+1],e[o]="")}),e=e.filter(i=>i!==null&&i!=="").map(i=>(i||"").trim());let s=e.shift()||"",n={};e.forEach(i=>{if(i=(i||"").trim(),/^[\p{Letter}0-9._/\- '()\t]+=/iu.test(i)){let o=i.split("="),c=(o[0]||"").toLowerCase().trim(),l=o.slice(1).join("=").trim();(!n[c]||l)&&(n[c]=l)}else n.list=n.list||[],n.list.push(i)});for(let i of Object.keys(n))["classname","style","align","margin","left","break","boxsize"].includes(i.toLowerCase())&&delete n[i],(n[i]===null||n[i]==="")&&delete n[i];for(let i of Object.keys(n))i==="list"?n[i]=n[i].map(o=>(t==="raw"&&(o=C(o)),t==="raw"?d(o):d(o).text())):(t==="raw"&&(n[i]=C(n[i])),n[i]=t==="raw"?d(n[i]):d(n[i]).text());return s&&(n.template=s.trim().toLowerCase().replace(/_/g," ")),n}function et(r,t){let e=p(r),s=e.year||e[1]||e.list?.[0],n=e.month||e[2]||e.list?.[1],i=e.day||e[3]||e.list?.[2];return t.push({template:"birth date",year:s,month:n,day:i}),s&&n&&i?`${g[Number(n)-1]||n} ${i}, ${s}`:s&&n?`${g[Number(n)-1]||n} ${s}`:s||""}function nt(r,t){let e=p(r),s=e.year||e[1]||e.list?.[0],n=e.month||e[2]||e.list?.[1],i=e.day||e[3]||e.list?.[2];return t.push({template:"death date",year:s,month:n,day:i}),s&&n&&i?`${g[Number(n)-1]||n} ${i}, ${s}`:s&&n?`${g[Number(n)-1]||n} ${s}`:s||""}function it(r,t){let e=p(r),s=e.year||e[1]||e.list?.[0],n=e.month||e[2]||e.list?.[1],i=e.day||e[3]||e.list?.[2];return t.push({template:"start date",year:s,month:n,day:i}),s&&n&&i?`${g[Number(n)-1]||n} ${i}, ${s}`:s&&n?`${g[Number(n)-1]||n} ${s}`:s||""}function st(r){let t=p(r),e=t.year||t[1]||t.list?.[0],s=t.month||t[2]||t.list?.[1],n=t.day||t[3]||t.list?.[2],i=t.since?"Since ":"As of ";return t.lc&&(i=i.toLowerCase()),t.bare&&(i=""),e&&s&&n?i+=`${g[Number(s)-1]||s} ${n}, ${e}`:e&&s?i+=`${g[Number(s)-1]||s} ${e}`:e&&(i+=e),i}function rt(r){let t=p(r),e=t.spouse||t[1]||t.list?.[0]||"",s=t.from||t[2]||t.list?.[1]||"",n=t.to||t[3]||t.list?.[2]||"",i=e;return s&&(n?i+=` (m. ${s}-${n})`:i+=` (m. ${s})`),i}function M(r){let t=p(r),e=t.list||[],s=0,n=0,i=l=>{let a=String(l.pop()||"").toUpperCase(),u=Number(l[0]||0),h=Number(l[1]||0),m=Number(l[2]||0);return(a==="S"||a==="W"?-1:1)*(u+h/60+m/3600)};e.length===2&&!isNaN(Number(e[0]))&&!isNaN(Number(e[1]))?(s=Number(e[0]),n=Number(e[1])):e.length===4?(s=/[SN]/i.test(e[1])?i([e[0],e[1]]):Number(e[0]),n=/[EW]/i.test(e[3])?i([e[2],e[3]]):Number(e[2])):e.length===6?(s=i(e.slice(0,3)),n=i(e.slice(3))):e.length===8&&(s=i(e.slice(0,4)),n=i(e.slice(4)));let o=s>=0?"N":"S",c=n>=0?"E":"W";return{template:"coord",lat:Math.round(Math.abs(s)*1e5)/1e5,lon:Math.round(Math.abs(n)*1e5)/1e5,latDir:o,lonDir:c,display:t.display}}function ot(r){let t=p(r),e=t.template||t.code||"";e==="currency"&&(e=t.code||"usd"),e=e.toLowerCase(),e==="us"&&(e="usd"),e==="uk"&&(e="gbp");let s=(f?.currency||T)[e]||"",n=t.amount||t[1]||t.list?.[0]||"";return`${s}${n}${!s&&t.code?" "+t.code:""}`}function at(r,t){let s=p(r).list||[],n=[];for(let i=0;i<s.length;i+=2)n.push({min:s[i],note:s[i+1]||""});return t.push({template:"goal",data:n}),"\u26BD "+n.map(i=>i.min+"'"+(i.note?` (${i.note})`:"")).join(", ")}function ct(r,t){let e=p(r),s=e.number||e[1]||e.list?.[0],n=(e.country||e[2]||e.list?.[1]||"").toLowerCase(),i=e.name||e[3]||e.list?.[2];t.push({template:"player",number:s,country:n,name:i});let c=(f?.flags||B).find(a=>n===a[1]||n===a[2]),l=`[[${i}]]`;return c?.[0]&&(l=c[0]+"  "+l),s&&(l=s+" "+l),l}function lt(r,t){let e=p(r),s=Object.keys(e).filter(i=>/^team[0-9]/.test(i)).map(i=>e[i]?.toLowerCase()),n={};s.forEach(i=>{n[i]={name:e[`name_${i}`],win:Number(e[`win_${i}`])||0,loss:Number(e[`loss_${i}`])||0,tie:Number(e[`tie_${i}`])||0,goals_for:Number(e[`gf_${i}`])||0,goals_against:Number(e[`ga_${i}`])||0}}),t.push({template:"sports table",date:e.update,teams:n})}function pt(r,t){let e=p(r),s=[],n=i=>String(i).padStart(2,"0");for(let i=1;i<7;i++){let o=[];for(let c=1;c<16;c+=2){let l=`rd${i}-team`;if(e[l+c]||e[l+n(c)]){let a=u=>{let h=e[`rd${i}-team${n(u)}`]?n(u):u;return{team:e[`rd${i}-team${h}`],score:e[`rd${i}-score${h}`],seed:e[`rd${i}-seed${h}`]}};o.push([a(c),a(c+1)])}else break}o.length&&s.push(o)}t.push({template:"playoffbracket",rounds:s})}function ut(r){let t=p(r),e=t.num||t[1]||t.list?.[0],s=t.two||t[2]||t.list?.[1],n=t.three||t[3]||t.list?.[2];return s==="-"||s==="to"||s==="and"?`${e} ${s} ${n}`:`${e} ${s}`}function ht(r){let t=p(r),e=t.a||t[1]||t.list?.[0],s=t.b||t[2]||t.list?.[1],n=t.c||t[3]||t.list?.[2];return n?`${e} ${s}/${n}`:s?`${e}/${s}`:`1/${e}`}function gt(r){let t=p(r),e=t.number||t[1]||t.list?.[0];e&&Number(e)&&(e=Number(e).toLocaleString());let s=e||"";return t.p&&(s=t.p+s),t.s&&(s=t.s+s),(t.u||t.ul||t.upl)&&(s+=" "+(t.u||t.ul||t.upl)),s}function ft(r){let t=p(r),e=t.first||t[1]||t.list?.[0]||"",s=t.last||t[2]||t.list?.[1]||"",n=`${e} ${s}`.trim();return t.nolink?t.target||n:t.dab?`[[${t.target||n} (${t.dab})|${n}]]`:t.target?`[[${t.target}|${n}]]`:`[[${n}]]`}function dt(r){return(p(r).list||[]).filter(e=>e).join(", ")}function mt(r){return(p(r).list||[]).filter(e=>e).join(", ")}function bt(r){return(p(r).list||[]).filter(e=>e).map(e=>"\u2022 "+e).join(`

`)}function P(r){let t=p(r),e=t[1]||t.list?.[0]||"",s=t[2]||t.list?.[1]||"";if(s)return s;let n=e;return n=n.replace(/^https?:\/\//,""),n=n.replace(/^www\./,""),n=n.replace(/\/.*$/,""),n||e}function I(r){let t=p(r),e=(t.template||"").toLowerCase();if(e==="nihongo2"||e==="nihongo-s")return t[1]||t.list?.[0]||"";if(e==="nihongo3"){let c=t[1]||t.list?.[0]||"",l=t[2]||t.list?.[1]||"";return l?`${c} (${l})`:c}let s=t[1]||t.list?.[0]||"",n=t[2]||t.list?.[1]||"",i=t[3]||t.list?.[2]||"",o=s||i||"";return n&&(o+=` (${n})`),o}function C(r){if(!r||typeof r!="string")return r;let t=O(r);for(let e of t){let s=e.name.toLowerCase();if(s==="coord"||s.startsWith("coor")){let n=M(e.body);if(n.lat&&n.lon){let i=`${n.lat}\xB0${n.latDir}, ${n.lon}\xB0${n.lonDir}`;r=r.replace(e.body,i)}continue}if(s==="birth date and age"||s==="bda"||s==="birth date"){let n=p(e.body),i=n.year||n[1]||n.list?.[0],o=n.month||n[2]||n.list?.[1],c=n.day||n[3]||n.list?.[2],l="";i&&o&&c?l=`${g[Number(o)-1]||o} ${c}, ${i}`:i&&o?l=`${g[Number(o)-1]||o} ${i}`:l=i||"",r=r.replace(e.body,l);continue}if(s==="death date and age"||s==="death date"){let n=p(e.body),i=n.year||n[1]||n.list?.[0],o=n.month||n[2]||n.list?.[1],c=n.day||n[3]||n.list?.[2],l="";i&&o&&c?l=`${g[Number(o)-1]||o} ${c}, ${i}`:i&&o?l=`${g[Number(o)-1]||o} ${i}`:l=i||"",r=r.replace(e.body,l);continue}if(s==="start date"||s==="end date"||s==="start date and age"||s==="end date and age"||s==="start"||s==="end"){let n=p(e.body),i=n.year||n[1]||n.list?.[0],o=n.month||n[2]||n.list?.[1],c=n.day||n[3]||n.list?.[2],l="";i&&o&&c?l=`${g[Number(o)-1]||o} ${c}, ${i}`:i&&o?l=`${g[Number(o)-1]||o} ${i}`:l=i||"",r=r.replace(e.body,l);continue}if(s==="url"){let n=P(e.body);r=r.replace(e.body,n);continue}if(s==="nihongo"||s==="nihongo2"||s==="nihongo3"||s==="nihongo-s"||s==="nihongo foot"){let n=I(e.body);r=r.replace(e.body,n);continue}if(s==="hlist"||s==="plainlist"||s==="flatlist"){let n=x(e.body);r=r.replace(e.body,n.join(", "));continue}if(s==="ubl"||s==="ubil"||s==="unbulleted list"){let n=x(e.body);r=r.replace(e.body,n.join(", "));continue}if(s==="bulleted list"){let n=x(e.body);r=r.replace(e.body,n.join(", "));continue}if(s==="us dollar"||s==="us$"||s==="usd"||s==="us dollar link"){let n=p(e.body),i=n[1]||n.list?.[0]||"";r=r.replace(e.body,`US$${i}`);continue}if(s==="increase"||s==="up"||s==="gain"){r=r.replace(e.body,"\u25B2");continue}if(s==="decrease"||s==="down"||s==="loss"){r=r.replace(e.body,"\u25BC");continue}if(s==="steady"||s==="no change"){r=r.replace(e.body,"\u25AC");continue}if(s==="nobold"||s==="no bold"){let n=p(e.body),i=n[1]||n.list?.[0]||"";r=r.replace(e.body,i);continue}if(s==="marriage"||s==="married"){let n=rt(e.body);r=r.replace(e.body,n);continue}}return r}function x(r){r=r.replace(/^\{\{/,"").replace(/\}\}$/,"");let t=r.split(/\n?\|/);return t.forEach((e,s)=>{e!==null&&(/\[\[[^\]]+$/.test(e)||/\{\{[^}]+$/.test(e)||e.split("{{").length!==e.split("}}").length||e.split("[[").length!==e.split("]]").length)&&(t[s+1]=t[s]+"|"+t[s+1],t[s]="")}),t=t.filter(e=>e!==null&&e!=="").map(e=>(e||"").trim()),t.shift(),t.filter(e=>!/^[\p{Letter}0-9._/\- '()\t]+=/iu.test(e)).map(e=>e.replace(/\[\[([^\]|]+)\|?([^\]]*)\]\]/g,(s,n,i)=>i||n).trim()).filter(e=>e)}var b=/^[#*:;|]+/,L=/^\*+[^:,|]{4}/,w=/^ ?#[^:,|]{4}/;function yt(r){let t=r.wiki.split(/\n/g),e=[],s=[];for(let n=0;n<t.length;n++)if(b.test(t[n])||L.test(t[n])||w.test(t[n])){let i=[],o=1;for(let l=n;l<t.length&&(b.test(t[l])||L.test(t[l])||w.test(t[l]));l++){let a=t[l];w.test(a)?(a=a.replace(/^ ?#*/,o+") ")+`
`,o++):b.test(a)&&(o=1,a=a.replace(b,"")),i.push(d(a))}n+=i.length-1;let c=i.filter(l=>l.text());c.length&&e.push(c)}else s.push(t[n]);r.lists=e.map(n=>new $(n)),r.wiki=s.join(`
`)}var _t=/(?:\n|^)(={2,6}[^=\n]{1,200}?={2,6})/g,kt=/^(={1,6})([^=\n]{1,200}?)={1,6}$/,xt=["references","reference","einzelnachweise","referencias","r\xE9f\xE9rences","\u811A\u6CE8"];function wt(r){let e=r._wiki.split(_t),s=[];for(let n=0;n<e.length;n+=2){let i=e[n-1]||"",o=e[n]||"";if(!o&&!i)continue;let c="",l=0,a=i.match(kt);a&&(c=A(d(a[2]||"").text()),l=a[1]?a[1].length-2:0),s.push(new S({title:c,depth:l,wiki:o},r))}return s.filter((n,i)=>new RegExp("^("+xt.join("|")+"):?","i").test(n.title())?n.paragraphs().length||n.templates().length?!0:(s[i+1]&&s[i+1].depth()>n.depth()&&(s[i+1]._depth-=1),!1):!0)}function k(r,t){return new N(r,t)}var $t="https://wikipedia-embeddings.r2.dev/wtf-data.json",Tt={async fetch(r){let e=new URL(r.url).pathname,s={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type"};if(r.method==="OPTIONS")return new Response(null,{headers:s});D($t).catch(()=>{});try{if(r.method==="POST"){let u=await r.json(),h=k(u.wikitext||"",{title:u.title||"Untitled"}),m=u.format||"json";return m==="md"||m==="markdown"?new Response(U(h),{headers:{...s,"Content-Type":"text/markdown; charset=utf-8"}}):Response.json(v(h),{headers:{...s,"Content-Type":"application/json; charset=utf-8"}})}if(e==="/"||e==="")return Response.json({name:"wiki.org.ai",description:"Wikipedia article parser API",usage:{"/Albert_Einstein":"Get article as Markdown (default)","/Albert_Einstein.json":"Get full article as JSON","/Albert_Einstein/summary":"Get concise summary","/Albert_Einstein/infobox":"Get infobox data only","/Albert_Einstein/links":"Get links only","/Albert_Einstein/text":"Get plain text","/fr/Paris":"French Wikipedia article","POST / { wikitext, title }":"Parse raw wikitext"}},{headers:{...s,"Content-Type":"application/json; charset=utf-8"}});let{title:n,lang:i,format:o,section:c}=jt(e);if(!n)return Response.json({error:"Invalid path"},{status:400,headers:s});let l=await Rt(n,i);if(!l)return Response.json({error:"Article not found",title:n},{status:404,headers:s});let a=k(l.wikitext,{title:l.title});if(c==="summary"){let u=a.sentences().slice(0,3).map(h=>h.text()).join(" ");return o==="json"?Response.json({title:a.title(),summary:u},{headers:{...s,"Content-Type":"application/json; charset=utf-8"}}):new Response(`# ${a.title()}

${u}`,{headers:{...s,"Content-Type":"text/markdown; charset=utf-8"}})}if(c==="infobox"){let u=a.infoboxes().map(h=>({type:h.type(),data:h.json()}));return Response.json({title:a.title(),infoboxes:u},{headers:{...s,"Content-Type":"application/json; charset=utf-8"}})}if(c==="links"){let u=a.links().map(h=>h.json());return Response.json({title:a.title(),links:u},{headers:{...s,"Content-Type":"application/json; charset=utf-8"}})}return c==="categories"?Response.json({title:a.title(),categories:a.categories()},{headers:{...s,"Content-Type":"application/json; charset=utf-8"}}):c==="text"?new Response(a.text(),{headers:{...s,"Content-Type":"text/plain; charset=utf-8"}}):o==="json"?Response.json(v(a),{headers:{...s,"Content-Type":"application/json; charset=utf-8"}}):new Response(U(a),{headers:{...s,"Content-Type":"text/markdown; charset=utf-8"}})}catch(n){return Response.json({error:n.message},{status:500,headers:s})}}};function jt(r){let t=decodeURIComponent(r.replace(/^\/+/,"")),e="en",s="md",n=null,i=t.match(/^([a-z]{2})\/(.+)$/);i&&(e=i[1],t=i[2]),t.endsWith(".json")&&(s="json",t=t.slice(0,-5));let o=["summary","infobox","links","categories","text"];for(let c of o)if(t.endsWith("/"+c)){n=c,t=t.slice(0,-(c.length+1));break}return{title:t,lang:e,format:s,section:n}}async function Rt(r,t){let e=`https://${t}.wikipedia.org/w/api.php`,s=new URLSearchParams({action:"query",titles:r,prop:"revisions",rvprop:"content",rvslots:"main",format:"json",formatversion:"2"}),n=await fetch(`${e}?${s}`,{headers:{"User-Agent":"wiki.org.ai/1.0"}});if(!n.ok)throw new Error(`Wikipedia API error: ${n.status}`);let o=(await n.json()).query?.pages?.[0];return!o||o.missing?null:{title:o.title,wikitext:o.revisions?.[0]?.slots?.main?.content||""}}function v(r){return{title:r.title(),isRedirect:r.isRedirect(),redirectTo:r.redirectTo()?.page?.()||null,categories:r.categories(),sections:r.sections().map(t=>({title:t.title(),depth:t.depth(),text:t.text().slice(0,2e3)})),infoboxes:r.infoboxes().map(t=>({type:t.type(),data:t.json()})),links:r.links().slice(0,100).map(t=>t.json()),coordinates:r.coordinates(),templates:r.templates().slice(0,50)}}function U(r){let t=[];t.push(`# ${r.title()?.replace(/_/g," ")||"Untitled"}`),t.push("");let e=r.sentences().slice(0,3);e.length&&(t.push(e.map(n=>n.text()).join(" ")),t.push(""));let s=r.infoboxes();if(s.length>0){let n=s[0];t.push(`## ${n.type()}`),t.push(""),t.push("| Field | Value |"),t.push("|-------|-------|");let i=n.json();for(let[o,c]of Object.entries(i))typeof c=="string"&&c.length<100&&t.push(`| ${o.replace(/_/g," ")} | ${c} |`);t.push("")}for(let n of r.sections()){let i=n.title();if(i&&i!=="Introduction"){let o="#".repeat(Math.min(n.depth()+2,6));t.push(`${o} ${i}`),t.push("");let c=n.text().trim();c&&(t.push(c.slice(0,2e3)),t.push(""))}}return t.join(`
`)}export{Tt as default};
