var g=["redirect","weiterleitung","redirection","redirecci\xF3n","\u043F\u0435\u0440\u0435\u043D\u0430\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435","\u062A\u062D\u0648\u064A\u0644","\u91CD\u5B9A\u5411"];var d=["file","image","fichier","archivo","datei","bestand","bild","plik","\u0444\u0430\u0439\u043B","\u30D5\u30A1\u30A4\u30EB","\u6587\u4EF6","\u6A94\u6848","\u05EA\u05DE\u05D5\u05E0\u05D4","\u0645\u0644\u0641","\u062A\u0635\u0648\u06CC\u0631"];function u(t,n){let i=n?.title||null,e=new RegExp("^\\s*#("+g.join("|")+")\\s*(\\[\\[[^\\]]{2,180}?\\]\\])","i");if(e.test(t)){let l=t.match(e)?.[2]?.match(/\[\[([^\]|]+)/);return{title:i,isRedirect:!0,redirectTo:l?.[1]||null,categories:[],text:"",sections:[]}}t=t.replace(/<!--[\s\S]*?-->/g,"").replace(/\r/g,"").replace(/&nbsp;/g," ").replace(/&[a-z]+;/gi," "),t=h(t);let r=m(t);t=t.replace(/\[\[(?:Category|Категория|分类)[^\]]*\]\]/gi,""),t=t.replace(/<[^>]+>/g," ").replace(/\[\[File:[^\]]*\]\]/gi,"").replace(/\[\[Image:[^\]]*\]\]/gi,""),t=t.replace(/\[\[([^\]|]+)\|([^\]]+)\]\]/g,"$2"),t=t.replace(/\[\[([^\]]+)\]\]/g,"$1"),t=t.replace(/\[https?:\/\/[^\]]+\]/g,""),t=t.replace(/''+/g,"").replace(/\n{3,}/g,`

`).trim();let a=x(t),o=a.map(s=>s.text).join(`

`);return{title:i||y(a[0]?.text||""),isRedirect:!1,redirectTo:null,categories:r,text:o,sections:a}}function h(t){let n=d.map(l=>l.toLowerCase()),i=[],e=0,r=0,a=0,o=!1,s=0;for(;s<t.length-1;){let l=t[s],c=t[s+1];if(l==="{"&&c==="{"){e===0&&!o&&i.push(t.slice(a,s)),e++,s+=2;continue}if(l==="}"&&c==="}"&&e>0){e--,e===0&&!o&&(a=s+2),s+=2;continue}if(l==="["&&c==="["&&e===0){let p=t.slice(s+2,s+20).toLowerCase();if(n.some(f=>p.startsWith(f+":"))&&!o){i.push(t.slice(a,s)),o=!0,r=1,s+=2;continue}else if(o){r++,s+=2;continue}}if(l==="]"&&c==="]"&&o){r--,r===0&&(o=!1,a=s+2),s+=2;continue}s++}return e===0&&!o&&a<t.length&&i.push(t.slice(a)),i.join("")}function m(t){let n=[],i=/\[\[(Category|Категория|分类):([^\]|]+)/gi,e;for(;(e=i.exec(t))!==null;)e[2]&&n.push(e[2].trim());return n}function x(t){let n=[],i=/(?:\n|^)(={2,6})([^=\n]+)\1/g,e=0,r="",a=0,o;for(;(o=i.exec(t))!==null;){let l=t.slice(e,o.index).trim();(l||n.length===0)&&n.push({title:r,depth:a,text:l}),r=o[2].trim(),a=o[1].length-2,e=o.index+o[0].length}let s=t.slice(e).trim();return s&&n.push({title:r,depth:a,text:s}),n}function y(t){return(t.split(`
`)[0]||"").match(/^'''([^']+)'''/)?.[1]||null}var k={async fetch(t){let i=new URL(t.url).pathname,e={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type"};if(t.method==="OPTIONS")return new Response(null,{headers:e});try{if(t.method==="POST"){let c=await t.json(),p=u(c.wikitext||"",{title:c.title});return Response.json(p,{headers:{...e,"Content-Type":"application/json; charset=utf-8"}})}if(i==="/"||i==="")return Response.json({name:"wiki.org.ai (fast mode)",description:"Fast Wikipedia article parser",note:"Optimized for 5ms CPU limit - no infobox parsing",usage:{"/Albert_Einstein":"Get article (Markdown)","/Albert_Einstein.json":"Get article (JSON)","/Albert_Einstein/text":"Get plain text","/fr/Paris":"French Wikipedia article"}},{headers:e});let{title:r,lang:a,format:o}=R(i);if(!r)return Response.json({error:"Invalid path"},{status:400,headers:e});let s=await b(r,a);if(!s)return Response.json({error:"Article not found",title:r},{status:404,headers:e});let l=u(s.wikitext,{title:s.title});return o==="json"?Response.json(l,{headers:{...e,"Content-Type":"application/json; charset=utf-8"}}):new Response($(l),{headers:{...e,"Content-Type":"text/markdown; charset=utf-8"}})}catch(r){return Response.json({error:r.message},{status:500,headers:e})}}};function R(t){let n=decodeURIComponent(t.replace(/^\/+/,"")),i="en",e="md",r=n.match(/^([a-z]{2})\/(.+)$/);return r&&(i=r[1],n=r[2]),n.endsWith(".json")&&(e="json",n=n.slice(0,-5)),n=n.replace(/\/(summary|infobox|links|categories|text)$/,""),{title:n,lang:i,format:e}}async function b(t,n){let i=`https://${n}.wikipedia.org/w/api.php`,e=new URLSearchParams({action:"query",titles:t,prop:"revisions",rvprop:"content",rvslots:"main",format:"json",formatversion:"2"}),r=await fetch(`${i}?${e}`,{headers:{"User-Agent":"wiki.org.ai/1.0"}});if(!r.ok)throw new Error(`Wikipedia API error: ${r.status}`);let o=(await r.json()).query?.pages?.[0];return!o||o.missing?null:{title:o.title,wikitext:o.revisions?.[0]?.slots?.main?.content||""}}function $(t){let n=[];n.push(`# ${t.title?.replace(/_/g," ")||"Untitled"}`),n.push("");let i=t.sections[0]?.text.split(/[.!?]/).slice(0,3).join(". ")+".";i.length>10&&(n.push(i),n.push(""));for(let e of t.sections.slice(1)){if(e.title){let r="#".repeat(Math.min(e.depth+2,6));n.push(`${r} ${e.title}`),n.push("")}e.text&&(n.push(e.text.slice(0,2e3)),n.push(""))}return n.join(`
`)}export{k as default};
